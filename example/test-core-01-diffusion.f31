  double :: d
  d = 0.1
  double[0..99, 0..99] :: rho_init
  rho_init[i,j] = 1e4 * (i==50) * (j==50)
  initial_state :: rho_init

  double[0..99, 0..99] :: rho_current
  current_state :: rho_current

  double[-1..100, -1..100] :: rho
  rho = rho_current | 0

  double[-1/2..99+1/2, 0..99] :: flux_x
  double[0..99, -1/2..99+1/2] :: flux_y
  flux_x[i+1/2,j] = rho[i+1,j] - rho[i,j]
  flux_y[i,j+1/2] = rho[i,j+1/2] - rho[i,j]

  double[0..99, 0..99] :: rho_next
  rho_next[i,j] = rho[i,j] + d * (flux_x[i+1/2,j]-flux_x[i-1/2,j] + flux_y[i+1/2,j]-flux_y[i-1/2,j])

  next_state :: rho_next
